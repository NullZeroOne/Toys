<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Subset-of-Craps</title>
<style>
    :root { font-family: system-ui, sans-serif; }
    body  { margin:0; padding:1rem; display:flex; flex-direction:column; gap:1rem; }

    #table      { display:flex; flex-wrap:wrap; gap:.6rem; }
    .panel      { padding:.8rem 1rem; border:2px solid #444; border-radius:8px; }
    .panel h2   { margin:0 0 .4rem; font-size:1.1rem; }

    #log        { height:12rem; overflow-y:auto; font-family:ui-monospace,monospace;
                  background:#111; color:#0f0; padding:.6rem; border-radius:4px;
                  white-space:pre-line; }

    button{ font-size:1rem; padding:.45rem .9rem; border-radius:6px; border:1px solid #333;
            transition:background .2s; }
    button:disabled{ opacity:.35; cursor:not-allowed; }
    button:not(:disabled):hover{ background:#ececec; }

    .row { display:flex; align-items:center; gap:.5rem; flex-wrap:wrap; }
    .money{ font-weight:600; }
    #diceFace{ font-size:3rem; text-align:center; }
</style>
</head>
<body>

<h1>Subset-of-Craps</h1>

<div id="table">

<div class="panel">
    <h2>Status</h2>
    <div class="row">Bankroll: <span id="bankroll" class="money">$100</span>
        <button id="btnBankroll">Set&nbsp;Bankroll</button></div>
    <div class="row">Base Bet: <span id="baseBet"  class="money">$1</span>
        <button id="btnBetSize">Set&nbsp;Bet</button></div>
    <div class="row">Max Odds: <span id="maxOdds">10Ã—</span>
        <button id="btnOddsMax">Set&nbsp;Max</button></div>
    <div class="row">Point: <span id="point">â€“</span></div>
</div>

<div class="panel">
    <h2>Actions</h2>
    <div class="row">
        <button id="btnPass">Pass</button>
        <button id="btnCome">Come</button>
        <button id="btnOdds">Odds</button>
        <button id="btnRoll">Roll Dice</button>
    </div>
    <div id="diceFace">ðŸŽ²</div>
</div>

<div class="panel" style="flex:1 1 12rem">
    <h2>Active Bets</h2>
    <div id="bets"></div>
</div>

</div><!-- /table -->

<div id="log"></div>

<script>
/* ---------- State ---------------------------------------------------- */
let bankroll=100, baseBet=1, maxOdds=10;
let point=null;                  // table point, null when OFF
let passBet=null;                // {flat, odds}
let comeBets=[];                 // [{point, flat, odds}]
let comeWaiting=false;           // blocks new come bet until next roll
const dieCh=["\u2680","\u2681","\u2682","\u2683","\u2684","\u2685"];
const $=id=>document.getElementById(id);

/* ---------- Helpers -------------------------------------------------- */
const log=msg=>{ $("log").textContent+=msg+"\n";
                 $("log").scrollTop=$("log").scrollHeight; };
const money=x=>"$"+x.toFixed(2);

function betSummary(){
    const out=[];
    if(passBet) out.push(`Pass-${point}:$${passBet.flat}${passBet.odds?`+${passBet.odds}`:""}`);
    for(const cb of comeBets){
        out.push(`Come-${cb.point??"?"}:$${cb.flat}${cb.odds?`+${cb.odds}`:""}`);
    }
    return out.join(" | ")||"none";
}
function totalBets(){
    let t=0;
    if(passBet) t+=passBet.flat+passBet.odds;
    for(const cb of comeBets) t+=cb.flat+cb.odds;
    return t;
}
function stateLine(){ log(`Bankroll ${money(bankroll)}, Bets ${money(totalBets())}`); }

function updateUI(){
    $("bankroll").textContent=money(bankroll);
    $("baseBet").textContent =money(baseBet);
    $("maxOdds").textContent =maxOdds+"Ã—";
    $("point").textContent   =point??"â€“";
    $("btnPass").disabled    =point!==null||bankroll<baseBet;
    $("btnCome").disabled    =comeWaiting||bankroll<baseBet;
    $("btnOdds").disabled    =eligibleForOdds().length===0;
    $("btnOddsMax").disabled =point!==null;
    renderBets();
}
function renderBets(){
    const w=$("bets"); w.innerHTML="";
    const add=(lbl,f,o)=>{const d=document.createElement("div");
        d.textContent=`${lbl}: Flat ${money(f)}${o?` + Odds ${money(o)}`:""}`; w.appendChild(d);};
    if(passBet) add(`Pass (${point??"â€“"})`, passBet.flat, passBet.odds);
    for(const cb of comeBets) add(`Come @ ${cb.point??"?"}`, cb.flat, cb.odds);
    if(!passBet&&comeBets.length===0) w.textContent="None";
}

/* ---------- Odds helpers -------------------------------------------- */
function oddsRate(p){ return (p===4||p===10)?2 : (p===5||p===9)?1.5 : 1.2; }
function eligibleForOdds(){
    const a=[];
    if(passBet && passBet.odds===0 && point) a.push(passBet);
    for(const cb of comeBets) if(cb.odds===0 && cb.point!==null) a.push(cb);
    return a;
}

/* ---------- Betting actions ----------------------------------------- */
function newPass(){
    bankroll-=baseBet;
    passBet={flat:baseBet, odds:0};
    log(`Placed PASS $${baseBet}`);
    stateLine(); updateUI();
}
function newCome(){
    bankroll-=baseBet;
    comeBets.push({point:null, flat:baseBet, odds:0});
    comeWaiting=true;
    log(`Placed COME $${baseBet} (waiting)`);
    stateLine(); updateUI();
}
function takeOdds(){
    const tgt=eligibleForOdds(); if(!tgt.length)return;
    let spent=0;
    for(const b of tgt){
        const o=Math.min(maxOdds*b.flat, bankroll-spent);
        if(o>0){ b.odds=o; spent+=o; }
    }
    bankroll-=spent;
    log(`Placed odds $${spent} on ${tgt.length} bet(s)`);
    stateLine(); updateUI();
}

/* ---------- Dice roll ------------------------------------------------ */
function rollDice(){
    /* pre-roll summary line */
    log(`Bets: ${betSummary()}`);
    /* roll dice */
    const d1=Math.floor(Math.random()*6)+1, d2=Math.floor(Math.random()*6)+1, sum=d1+d2;
    $("diceFace").textContent=dieCh[d1-1]+dieCh[d2-1];
    log(`Roll: ${d1}+${d2} = ${sum}`);
    /* COME-OUT phase */
    if(point===null){
        if(sum===7||sum===11){
            if(passBet){ bankroll+=passBet.flat*2; log(`PASS wins even (1:1) +$${passBet.flat}`); passBet=null; }
            /* waiting come handled below */
        }else if(sum===2||sum===3||sum===12){
            if(passBet){ log(`PASS loses`); passBet=null; }
        }else{ point=sum; log(`Point established at ${point}`); }
    /* POINT-ON phase */
    }else{
        if(sum===point){
            const winFlat=passBet.flat, winOdds=passBet.odds*oddsRate(point);
            bankroll+=winFlat+passBet.flat+winOdds+passBet.odds;
            log(`PASS hits: flat ${money(winFlat)} (1:1), odds ${money(winOdds)} (${oddsRate(point)}:1)`);
            passBet=null; point=null;
        }else if(sum===7){
            let lost=0;
            if(passBet){ lost+=passBet.flat+passBet.odds; passBet=null; }
            for(const cb of comeBets) lost+=cb.flat+cb.odds;
            comeBets=[];
            bankroll-=0; // lost already deducted when placed
            log(`Seven-out: all established bets lose (-$${lost})`);
            point=null;
        }
    }
    /* Come bet processing */
    for(const cb of [...comeBets]){
        if(cb.point===null){           // first roll after placement
            if([7,11].includes(sum)){
                bankroll+=cb.flat*2;
                log(`COME wins $${cb.flat} (1:1)`);
                comeBets.splice(comeBets.indexOf(cb),1);
            }else if([2,3,12].includes(sum)){
                log(`COME craps out (-$${cb.flat})`);
                comeBets.splice(comeBets.indexOf(cb),1);
            }else{
                cb.point=sum; log(`COME travels to ${sum}`);
            }
        }else{                         // established come bet
            if(sum===cb.point){
                const winFlat=cb.flat, winOdds=cb.odds*oddsRate(cb.point);
                bankroll+=winFlat+cb.flat+winOdds+cb.odds;
                log(`COME on ${cb.point} hits: flat ${money(winFlat)} (1:1), odds ${money(winOdds)} (${oddsRate(cb.point)}:1)`);
                comeBets.splice(comeBets.indexOf(cb),1);
            }
        }
    }
    comeWaiting=false;
    stateLine(); updateUI();
}

/* ---------- UI hooks ------------------------------------------------- */
$("btnPass").onclick = newPass;
$("btnCome").onclick = newCome;
$("btnOdds").onclick = takeOdds;
$("btnRoll").onclick = rollDice;

$("btnBankroll").onclick=()=>{
    const v=parseFloat(prompt("New bankroll:", bankroll)); if(!isNaN(v)&&v>=0){ bankroll=v; log(`Bankroll set to ${money(v)}`); stateLine(); updateUI(); }
};
$("btnBetSize").onclick=()=>{
    const v=parseFloat(prompt("New base bet:", baseBet)); if(!isNaN(v)&&v>0){ baseBet=v; log(`Base bet set to ${money(v)}`); stateLine(); updateUI(); }
};
$("btnOddsMax").onclick=()=>{
    const v=parseInt(prompt("Max odds multiple:", maxOdds),10); if(!isNaN(v)&&v>0){ maxOdds=v; log(`Max odds set to ${v}Ã—`); stateLine(); updateUI(); }
};

/* ---------- Init ----------------------------------------------------- */
log("Welcome! Bankroll $100. Base bet $1. Max odds 10Ã—.");
stateLine(); updateUI();
</script>
</body>
</html>
