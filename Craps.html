<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Subset-of-Craps</title>
<style>
    :root { font-family: system-ui,sans-serif; }
    body  { margin:0; padding:1rem; display:flex; flex-direction:column; gap:1rem; }

    #table      { display:flex; flex-wrap:wrap; gap:.6rem; }
    .panel      { padding:.8rem 1rem; border:2px solid #444; border-radius:8px; }
    .panel h2   { margin:0 0 .4rem; font-size:1.1rem; }

    #log        { height:12rem; overflow-y:auto; font-family:ui-monospace,monospace;
                  background:#111; color:#0f0; padding:.6rem; border-radius:4px;
                  white-space:pre; }

    button{ font-size:1rem; padding:.45rem .9rem; border-radius:6px; border:1px solid #333;
            transition:background .2s; }
    button:disabled{ opacity:.35; cursor:not-allowed; }
    button:not(:disabled):hover{ background:#ececec; }

    .row  { display:flex; align-items:center; gap:.5rem; flex-wrap:wrap; }
    .money{ font-weight:600; }

    #diceFace{ font-size:6rem; text-align:center; }  /* doubled */

    .win  { color:#00e000; }
    .lose { color:#ff4444; }
</style>
</head>
<body>

<h1>Subset-of-Craps</h1>

<div id="table">

<div class="panel">
    <h2>Status</h2>
    <div class="row">Bankroll: <span id="bankroll" class="money">$100</span>
        <button id="btnBankroll">Set&nbsp;Bankroll</button></div>
    <div class="row">Base Bet: <span id="baseBet"  class="money">$1</span>
        <button id="btnBetSize">Set&nbsp;Bet</button></div>
    <div class="row">Max Odds: <span id="maxOdds">10Ã—</span>
        <button id="btnOddsMax">Set&nbsp;Max</button></div>
    <div class="row">Point: <span id="point">â€“</span></div>
</div>

<div class="panel">
    <h2>Actions</h2>
    <div class="row">
        <button id="btnPass">Pass</button>
        <button id="btnCome">Come</button>
        <button id="btnOdds">Odds</button>
        <button id="btnRoll">Roll Dice</button>
    </div>
    <div id="diceFace">ðŸŽ²</div>
</div>

<div class="panel" style="flex:1 1 12rem">
    <h2>Bets</h2>
    <div id="bets"></div>
</div>

</div><!-- /table -->

<div id="log"></div>

<script>
/* ---------- State variables ----------------------------------------- */
let bankroll=100, baseBet=1, maxOdds=10;
let point=null;
let passBet=null;      // {type:"pass", point, flat, odds, result?, delta?}
let comeBets=[];       // array of come bets
let comeWaiting=false;

const dieCh=["\u2680","\u2681","\u2682","\u2683","\u2684","\u2685"];
const $=id=>document.getElementById(id);

/* ---------- Logging -------------------------------------------------- */
function log(msg){
    const d=document.createElement("div");
    d.textContent=msg;
    $("log").appendChild(d);
    $("log").scrollTop=$("log").scrollHeight;
}

/* ---------- Utilities ------------------------------------------------ */
const money=x=>"$"+x.toFixed(2);
const oddsRate=p=>(p===4||p===10)?2:(p===5||p===9)?1.5:1.2;

/* ---------- Purge resolved bets before each new roll ---------------- */
function purgeResolved(){
    if(passBet && passBet.result) passBet=null;
    comeBets=comeBets.filter(b=>!b.result);
}

/* ---------- Render bets panel --------------------------------------- */
function renderBets(){
    const items=[];
    if(passBet) items.push(passBet);
    items.push(...comeBets);
    items.sort((a,b)=>{
        const ka=a.point===null?99:a.point, kb=b.point===null?99:b.point;
        return ka!==kb?ka-kb: (a.type==="pass"?-1:1);
    });

    const wrap=$("bets"); wrap.innerHTML="";
    for(const b of items){
        const lbl=b.type==="pass"?`Pass (${b.point??"â€“"})`
                                 :`Come @ ${b.point??"?"}`;
        const stake=`Flat ${money(b.flat)}${b.odds?` + Odds ${money(b.odds)}`:""}`;
        const delta=b.result?` ${b.result==="win"?"+":"-"}${money(Math.abs(b.delta))}`:"";
        const div=document.createElement("div");
        div.textContent=`${lbl}: ${stake}${delta}`;
        if(b.result==="win") div.className="win";
        if(b.result==="lose") div.className="lose";
        wrap.appendChild(div);
    }
    if(!items.length) wrap.textContent="None";
}

/* ---------- Update UI ------------------------------------------------ */
function updateUI(){
    $("bankroll").textContent=money(bankroll);
    $("baseBet").textContent =money(baseBet);
    $("maxOdds").textContent =maxOdds+"Ã—";
    $("point").textContent   =point??"â€“";

    /* Pass enabled when puck OFF and no active (unresolved) pass bet */
    const activePass = passBet && !passBet.result;
    $("btnPass").disabled = point!==null || activePass || bankroll<baseBet;

    $("btnCome").disabled = comeWaiting || bankroll<baseBet;

    $("btnOdds").disabled = eligibleForOdds().length===0;

    /* Roll disabled during come-out until pass bet placed */
    $("btnRoll").disabled = point===null && !activePass;

    $("btnOddsMax").disabled = point!==null;

    renderBets();
}

/* ---------- Odds eligibility ---------------------------------------- */
function eligibleForOdds(){
    const arr=[];
    if(passBet && passBet.odds===0 && point) arr.push(passBet);
    for(const c of comeBets) if(c.point!==null && c.odds===0) arr.push(c);
    return arr;
}

/* ---------- Betting actions ----------------------------------------- */
function newPass(){
    bankroll-=baseBet;
    passBet={type:"pass", point:null, flat:baseBet, odds:0};
    log(`Placed PASS ${money(baseBet)}`);
    stateLine(); updateUI();
}
function newCome(){
    bankroll-=baseBet;
    comeBets.push({type:"come", point:null, flat:baseBet, odds:0});
    comeWaiting=true;
    log(`Placed COME ${money(baseBet)} (waiting)`);
    stateLine(); updateUI();
}
function takeOdds(){
    const tgt=eligibleForOdds(); if(!tgt.length)return;
    let spent=0;
    for(const b of tgt){
        const o=Math.min(maxOdds*b.flat, bankroll-spent);
        if(o>0){ b.odds=o; spent+=o; }
    }
    bankroll-=spent;
    log(`Placed odds ${money(spent)} on ${tgt.length} bet(s)`);
    stateLine(); updateUI();
}

/* ---------- Helpers for results ------------------------------------- */
function stateLine(){ log(`Bankroll ${money(bankroll)}, Bets ${money(totalOutstanding())}`); }
function totalOutstanding(){
    let t=0; if(passBet) t+=passBet.flat+passBet.odds;
    for(const c of comeBets) t+=c.flat+c.odds;
    return t;
}
function resolveWin(b, rolled){
    const flat=b.flat, odds=b.odds?b.odds*oddsRate(rolled):0;
    bankroll+=flat+odds+b.flat+b.odds;
    b.delta=flat+odds; b.result="win";
    const rate=b.odds?` (${oddsRate(rolled)}:1)`:"";
    log(`${b.type==="pass"?"PASS":"COME on "+rolled} wins: flat ${money(flat)} (1:1)${b.odds?`, odds ${money(odds)}${rate}`:""}`);
}
function resolveLoss(b,reason){
    b.delta=-(b.flat+b.odds); b.result="lose";
    log(`${reason}: ${b.type==="pass"?"PASS":"COME"+(b.point!==null?" on "+b.point:"")} loses ${money(b.flat+b.odds)}`);
}

/* ---------- Roll Dice ------------------------------------------------ */
function rollDice(){
    purgeResolved();

    /* summary line */
    const summ=[]; if(passBet)summ.push(`Pass-${passBet.point??"null"}:$${passBet.flat}${passBet.odds?`+${passBet.odds}`:""}`);
    for(const c of comeBets)summ.push(`Come-${c.point??"?"}:$${c.flat}${c.odds?`+${c.odds}`:""}`);
    log(`Bets: ${summ.join(" | ")||"none"}`);

    /* dice */
    const d1=Math.floor(Math.random()*6)+1, d2=Math.floor(Math.random()*6)+1, sum=d1+d2;
    $("diceFace").textContent=dieCh[d1-1]+dieCh[d2-1];
    log(`Roll: ${d1}+${d2} = ${sum}`);

    const comingOut=(point===null);
    if(comingOut){
        if([7,11].includes(sum)){
            if(passBet) resolveWin(passBet,sum);
        }else if([2,3,12].includes(sum)){
            if(passBet) resolveLoss(passBet,"Craps");
        }else{
            point=sum; if(passBet) passBet.point=point;
            log(`Point set to ${point}`);
        }
    }else{ // point on
        if(sum===point){
            if(passBet) resolveWin(passBet,sum);
            point=null;
        }else if(sum===7){
            if(passBet) resolveLoss(passBet,"Seven-out");
            for(const c of comeBets.filter(c=>c.point!==null)) resolveLoss(c,"Seven-out");
        }
    }

    /* come bets */
    for(const c of comeBets){
        if(c.result) continue;
        if(c.point===null){
            if([7,11].includes(sum)) resolveWin(c,sum);
            else if([2,3,12].includes(sum)) resolveLoss(c,"COME craps");
            else{ c.point=sum; log(`COME travels to ${sum}`); }
        }else{
            if(sum===c.point) resolveWin(c,sum);
            else if(sum===7)  resolveLoss(c,"Seven-out");
        }
    }

    comeWaiting=false;
    stateLine(); updateUI();
}

/* ---------- Event wiring -------------------------------------------- */
$("btnPass").onclick=newPass;
$("btnCome").onclick=newCome;
$("btnOdds").onclick=takeOdds;
$("btnRoll").onclick=rollDice;

$("btnBankroll").onclick=()=>{
    const v=parseFloat(prompt("New bankroll:", bankroll));
    if(!isNaN(v)&&v>=0){ bankroll=v; log(`Bankroll set to ${money(v)}`); stateLine(); updateUI(); }
};
$("btnBetSize").onclick=()=>{
    const v=parseFloat(prompt("New base bet:", baseBet));
    if(!isNaN(v)&&v>0){ baseBet=v; log(`Base bet set to ${money(v)}`); stateLine(); updateUI(); }
};
$("btnOddsMax").onclick=()=>{
    const v=parseInt(prompt("Max odds multiple:", maxOdds),10);
    if(!isNaN(v)&&v>0){ maxOdds=v; log(`Max odds set to ${v}Ã—`); stateLine(); updateUI(); }
};

/* ---------- Init ----------------------------------------------------- */
log("Welcome! Bankroll $100. Base bet $1. Max odds 10Ã—.");
stateLine(); updateUI();
</script>
</body>
</html>
