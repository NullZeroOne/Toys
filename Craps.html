<!-- craps.html – subset-of-craps web app
     Copyright © 2025 Matthew Laubach
     MIT License – see https://opensource.org/licenses/MIT                           -->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Subset-of-Craps (Pass / Come / Odds)</title>
<style>
    :root { font-family: system-ui, sans-serif; }
    body   { margin: 0; padding: 1rem; display: flex; flex-direction: column; gap: 1rem; }
    h1     { margin: 0 0 .5rem 0; font-size: 1.5rem; }

    /* layout */
    #table      { display: flex; flex-wrap: wrap; gap: .6rem; }
    .panel      { padding: .8rem 1rem; border: 2px solid #444; border-radius: 8px; }
    .panel h2   { margin: 0 0 .4rem; font-size: 1.1rem; }
    #log        { height: 11rem; overflow-y: auto; font-family: ui-monospace, monospace;
                  background:#111; color:#0f0; padding:.6rem; border-radius:4px; }

    /* buttons / inputs */
    button, input[type=number] {
        font-size: 1rem; padding: .4rem .8rem; border-radius: 6px; border: 1px solid #333;
        transition: background .2s;
    }
    button:disabled {
        opacity: .35; cursor: not-allowed;
    }
    button:not(:disabled):hover {
        background: #ececec;
    }
    .money      { font-weight: 600; }
    .dice       { font-size: 1.3rem; font-weight: 600; }

    /* compact flex rows */
    .row { display: flex; align-items: center; gap: .5rem; flex-wrap: wrap; }
</style>
</head>
<body>

<h1>Subset-of-Craps</h1>

<div id="table">

<!-- status panel -->
<div class="panel">
    <h2>Status</h2>
    <div class="row">Bankroll: <span id="bankroll" class="money">$100</span>
        <button id="btnBankroll">Set&nbsp;Bankroll</button>
    </div>
    <div class="row">Base Bet: <span id="baseBet" class="money">$1</span>
        <button id="btnBetSize">Set&nbsp;Bet</button>
    </div>
    <div class="row">Max Odds: <span id="maxOdds">10×</span>
        <button id="btnOddsMax">Set&nbsp;Max</button>
    </div>
    <div class="row">Point: <span id="point">–</span></div>
    <div class="row">Dice: <span id="dice" class="dice">-</span></div>
    <div class="row"><label><input type="checkbox" id="oddsOnComeOut" checked>
        Odds active after point (OFF during come-out)</label></div>
</div>

<!-- betting panel -->
<div class="panel">
    <h2>Actions</h2>
    <div class="row">
        <button id="btnPass">Pass</button>
        <button id="btnCome">Come</button>
        <button id="btnOdds">Odds</button>
        <button id="btnRoll">Roll Dice</button>
    </div>
</div>

<!-- active bets -->
<div class="panel" style="flex:1 1 12rem">
    <h2>Active Bets</h2>
    <div id="bets"></div>
</div>

</div><!-- /table -->

<div id="log"></div>

<script>
/* ---------- State ------------------------------------------------------- */
let bankroll = 100;
let baseBet  = 1;
let maxOdds  = 10;
let point    = null;        // current table point, null when off
let passBet  = null;        // {flat, odds}
let comeBets = [];          // [{point, flat, odds}]
let rng      = () => Math.floor(Math.random()*6)+1;

/* ---------- Helpers ----------------------------------------------------- */
const $ = id => document.getElementById(id);
const log = msg => { $("log").textContent += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
                     $("log").scrollTop = $("log").scrollHeight; };

function money(x){ return "$"+x.toFixed(2); }

function updateUI(){
    $("bankroll").textContent = money(bankroll);
    $("baseBet").textContent  = money(baseBet);
    $("maxOdds").textContent  = maxOdds + "×";
    $("point").textContent    = point ?? "–";
    $("dice").textContent     = "-";

    // Enable/disable buttons
    $("btnPass").disabled   = point !== null || bankroll < baseBet;
    $("btnCome").disabled   = bankroll < baseBet;
    $("btnOdds").disabled   = eligibleForOdds().length===0;
    $("btnOddsMax").disabled= point !== null;   // change max only when no point
    $("btnRoll").disabled   = false;

    // render bets table
    const wrap = $("bets");
    wrap.innerHTML = "";
    if(passBet){
        wrap.appendChild(line(`Pass (point ${point??'–'})`, passBet.flat, passBet.odds));
    }
    for(const cb of comeBets){
        wrap.appendChild(line(`Come @ ${cb.point}`, cb.flat, cb.odds));
    }
    if(!passBet && comeBets.length===0){
        wrap.textContent = "None";
    }
    function line(label, flat, odds){
        const div = document.createElement("div");
        div.textContent = `${label}: Flat ${money(flat)}${odds?` + Odds ${money(odds)}`:""}`;
        return div;
    }
}

function payOdds(mult, point){
    // true odds: 2:1 on 4/10, 3:2 on 5/9, 6:5 on 6/8
    return mult * (
        (point===4||point===10)?2 :
        (point===5||point===9)?1.5 : 1.2 );  // 6:5 = 1.2
}

function eligibleForOdds(){
    const arr=[];
    if(passBet && passBet.odds===0 && point) arr.push(passBet);
    for(const cb of comeBets) if(cb.odds===0) arr.push(cb);
    return arr;
}

/* ---------- Game actions ------------------------------------------------ */
function newPass(){
    bankroll -= baseBet;
    passBet = {flat:baseBet, odds:0};
    log(`Bet PASS ${money(baseBet)}.`);
}

function newCome(){
    bankroll -= baseBet;
    comeBets.push({point:null, flat:baseBet, odds:0});
    log(`Bet COME ${money(baseBet)} (waiting to travel).`);
}

function takeOdds(){
    const targets = eligibleForOdds();
    let total=0;
    for(const b of targets){
        const o = Math.min(maxOdds * b.flat, bankroll - total);
        if(o>0){ b.odds = o; total+=o; }
    }
    bankroll -= total;
    if(total>0) log(`Odds taken: ${money(total)} on ${targets.length} bet(s).`);
}

function resolveBet(winFlat, bet){
    const {point:p, flat, odds} = bet;
    if(winFlat){
        bankroll += flat * 2;           // even-money
        if(odds && (point || p)) bankroll += odds + payOdds(odds, point||p);
    }else{
        // lose: nothing (flat & odds already removed from bankroll)
    }
}

function rollDice(){
    const d1=rng(), d2=rng(), sum=d1+d2;
    $("dice").textContent = `${d1} + ${d2} = ${sum}`;
    if(point===null){          /* COME-OUT */
        if(sum===7||sum===11){
            if(passBet){ bankroll += passBet.flat*2; log(`PASS wins ${money(passBet.flat)}.`); passBet=null; }
            log(`Natural ${sum}. New come-out.`);
        }else if(sum===2||sum===3||sum===12){
            if(passBet){ log(`Craps ${sum}. PASS loses.`); passBet=null; }
        }else{
            point=sum; log(`Point is set to ${point}.`);
        }
    }else{                      /* POINT ON */
        if(sum===point){
            resolveBet(true,passBet);
            log(`Point ${point} hit! PASS paid.`);
            point=null; passBet=null;
        }else if(sum===7){
            log(`Seven-out. All odds and flat bets lose.`);
            passBet=null; point=null;
            comeBets=[]; // all lose
        }
    }
    /* Handle COME bets in all cases except on the roll they were placed */
    for(const cb of [...comeBets]){          // clone because we may splice
        if(cb.point===null){                 // this is first roll after placement
            if(sum===7||sum===11){
                bankroll += cb.flat*2;       // immediate win
                log(`COME wins on ${sum}: +${money(cb.flat)}.`);
                comeBets.splice(comeBets.indexOf(cb),1);
            }else if(sum===2||sum===3||sum===12){
                log(`COME craps on ${sum}.`);
                comeBets.splice(comeBets.indexOf(cb),1);
            }else{
                cb.point=sum; log(`COME ${money(cb.flat)} travels to ${sum}.`);
            }
        }else{
            if(sum===cb.point){
                resolveBet(true,cb);
                log(`COME on ${cb.point} hit! Paid flat${cb.odds?"+odds":""}.`);
                comeBets.splice(comeBets.indexOf(cb),1);
            }else if(sum===7){
                // handled above: all lose
            }
        }
    }
    if(sum===7 && point!==null){
        /* come-bet seven-out already handled */
    }
    updateUI();
}

/* ---------- Event wiring ----------------------------------------------- */
$("btnPass").onclick  = () => { newPass(); updateUI(); };
$("btnCome").onclick  = () => { newCome(); updateUI(); };
$("btnOdds").onclick  = () => { takeOdds(); updateUI(); };
$("btnRoll").onclick  = rollDice;

$("btnBankroll").onclick = () => {
    const v = parseFloat(prompt("Enter new bankroll:", bankroll));
    if(!isNaN(v)&&v>=0){ bankroll=v; log(`Bankroll set to ${money(v)}.`); updateUI(); }
};
$("btnBetSize").onclick = () => {
    const v = parseFloat(prompt("Enter base bet size:", baseBet));
    if(!isNaN(v)&&v>0){ baseBet=v; log(`Base bet set to ${money(v)}.`); updateUI(); }
};
$("btnOddsMax").onclick = () => {
    const v = parseInt(prompt("Enter max odds multiple (e.g., 1-100):", maxOdds),10);
    if(!isNaN(v)&&v>0){ maxOdds=v; log(`Max odds multiple set to ${v}×.`); updateUI(); }
};

/* ---------- Init -------------------------------------------------------- */
log("Welcome! Bankroll $100. Base bet $1. Max odds 10×.");
updateUI();
</script>
</body>
</html>
