<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Subset-of-Craps</title>
<style>
    :root { font-family: system-ui, sans-serif; }
    body  { margin:0; padding:1rem; display:flex; flex-direction:column; gap:1rem; }

    #table      { display:flex; flex-wrap:wrap; gap:.6rem; }
    .panel      { padding:.8rem 1rem; border:2px solid #444; border-radius:8px; }
    .panel h2   { margin:0 0 .4rem; font-size:1.1rem; }

    #log        { height:12rem; overflow-y:auto; font-family:ui-monospace,monospace;
                  background:#111; color:#0f0; padding:.6rem; border-radius:4px;
                  white-space:pre; }

    button{ font-size:1rem; padding:.45rem .9rem; border-radius:6px; border:1px solid #333;
            transition:background .2s; }
    button:disabled{ opacity:.35; cursor:not-allowed; }
    button:not(:disabled):hover{ background:#ececec; }

    .row  { display:flex; align-items:center; gap:.5rem; flex-wrap:wrap; }
    .money{ font-weight:600; }

    #diceFace{ font-size:6rem; text-align:center; }   /* big dice */

    .win  { color:#00e000; }
    .lose { color:#ff4444; }
</style>
</head>
<body>

<h1>Subset-of-Craps</h1>

<div id="table">

<div class="panel">
    <h2>Status</h2>
    <div class="row">Bankroll: <span id="bankroll" class="money">$100</span>
        <button id="btnBankroll">Set&nbsp;Bankroll</button></div>
    <div class="row">Base Bet: <span id="baseBet"  class="money">$1</span>
        <button id="btnBetSize">Set&nbsp;Bet</button></div>
    <div class="row">Max Odds: <span id="maxOdds">10Ã—</span>
        <button id="btnOddsMax">Set&nbsp;Max</button></div>
    <div class="row">Point: <span id="point">â€“</span></div>
</div>

<div class="panel">
    <h2>Actions</h2>
    <div class="row">
        <button id="btnPass">Pass</button>
        <button id="btnCome">Come</button>
        <button id="btnOdds">Odds</button>
        <button id="btnRoll">Roll Dice</button>
    </div>
    <div id="diceFace">ðŸŽ²</div>
</div>

<div class="panel" style="flex:1 1 12rem">
    <h2>Bets</h2>
    <div id="bets"></div>
</div>

</div><!-- /table -->

<div id="log"></div>

<script>
/* ---------- Session & state ----------------------------------------- */
let bankroll = 100,
    baseBet  = 1,
    maxOdds  = 10;

const sessionStart = bankroll;   // for up / down read-out
let gamesCompleted = 0;          // finished points counter

let point    = null;             // current point or null
let passBet  = null;             // single pass bet object
let comeBets = [];               // array of come bet objects
let comeWaiting = false;         // blocks extra come until next roll

const dieCh = ["\u2680","\u2681","\u2682","\u2683","\u2684","\u2685"];
const $ = id => document.getElementById(id);

/* ---------- Logging (copy-safe lines) ------------------------------- */
function log(msg){
    const div = document.createElement("div");
    div.textContent = msg;
    $("log").appendChild(div);
    $("log").scrollTop = $("log").scrollHeight;
}

/* ---------- Money helpers ------------------------------------------ */
const money = x => "$"+x.toFixed(2);
const oddsRate = p => (p===4||p===10)?2 : (p===5||p===9)?1.5 : 1.2;

/* ---------- Remove resolved rows before new roll ------------------- */
function purgeResolved(){
    if(passBet && passBet.result) passBet = null;
    comeBets = comeBets.filter(b => !b.result);
}

/* ---------- Bets panel --------------------------------------------- */
function renderBetsList(){
    const list = [];
    if(passBet) list.push(passBet);
    list.push(...comeBets);

    list.sort((a,b)=>{
        const ka = a.point===null ? 99 : a.point,
              kb = b.point===null ? 99 : b.point;
        if(ka !== kb) return ka - kb;
        return a.type==="pass" ? -1 : 1;           // pass before come if same num
    });

    const wrap = $("bets"); wrap.innerHTML = "";
    if(!list.length){ wrap.textContent="None"; return; }

    for(const b of list){
        const label = b.type==="pass" ? `Pass (${b.point??"â€“"})`
                                      : `Come @ ${b.point??"?"}`;
        const stake = `Flat ${money(b.flat)}${b.odds?` + Odds ${money(b.odds)}`:""}`;
        const delta = b.result ? ` ${b.result==="win"?"+":"-"}${money(Math.abs(b.delta))}` : "";
        const div   = document.createElement("div");
        div.textContent = `${label}: ${stake}${delta}`;
        if(b.result==="win")  div.className="win";
        if(b.result==="lose") div.className="lose";
        wrap.appendChild(div);
    }
}

/* ---------- Outstanding live money --------------------------------- */
function totalOutstanding(){
    let t = 0;
    if(passBet && !passBet.result) t += passBet.flat + passBet.odds;
    for(const c of comeBets) if(!c.result) t += c.flat + c.odds;
    return t;
}

/* ---------- State line w/ up/down & totals ------------------------- */
function stateLine(){
    const bets  = totalOutstanding();
    const total = bankroll + bets;
    const delta = total - sessionStart;
    log(`Bankroll ${money(bankroll)}, Bets ${money(bets)}, Total ${money(total)} (${delta>=0?"Up":"Down"} ${money(Math.abs(delta))})`);
}

/* ---------- UI refresh --------------------------------------------- */
function updateUI(renderBets=true){
    $("bankroll").textContent = money(bankroll);
    $("baseBet").textContent  = money(baseBet);
    $("maxOdds").textContent  = maxOdds + "Ã—";
    $("point").textContent    = point ?? "â€“";

    const activePass = passBet && !passBet.result;
    $("btnPass").disabled = point!==null || activePass || bankroll<baseBet;
    $("btnCome").disabled = comeWaiting || bankroll<baseBet;
    $("btnOdds").disabled = eligibleForOdds().length===0;
    $("btnRoll").disabled = point===null && !activePass;
    $("btnOddsMax").disabled = point!==null;

    if(renderBets) renderBetsList();
}

/* ---------- Odds eligibility --------------------------------------- */
function eligibleForOdds(){
    const a=[];
    if(passBet && passBet.odds===0 && point!==null) a.push(passBet);
    for(const c of comeBets) if(c.point!==null && c.odds===0) a.push(c);
    return a;
}

/* ---------- Place bets --------------------------------------------- */
function newPass(){
    bankroll -= baseBet;
    passBet = {type:"pass", point:null, flat:baseBet, odds:0};
    log(`Placed PASS ${money(baseBet)}`);
    stateLine(); updateUI();
}
function newCome(){
    bankroll -= baseBet;
    comeBets.push({type:"come", point:null, flat:baseBet, odds:0});
    comeWaiting = true;
    log(`Placed COME ${money(baseBet)} (waiting)`);
    stateLine(); updateUI();
}
function takeOdds(){
    const tgt = eligibleForOdds(); if(!tgt.length) return;
    let spent=0;
    for(const b of tgt){
        const o=Math.min(maxOdds*b.flat, bankroll-spent);
        if(o>0){ b.odds=o; spent+=o; }
    }
    bankroll -= spent;
    log(`Placed odds ${money(spent)} on ${tgt.length} bet(s)`);
    stateLine(); updateUI();
}

/* ---------- Win / loss helpers ------------------------------------- */
function resolveWin(b, num){
    const flat = b.flat;
    const odds = b.odds ? b.odds*oddsRate(num) : 0;
    bankroll += flat + odds + b.flat + b.odds;
    b.delta  = flat + odds;
    b.result = "win";
    const rate = b.odds ? ` (${oddsRate(num)}:1)` : "";
    log(`${b.type==="pass"?"PASS":"COME on "+num} wins: flat ${money(flat)} (1:1)${b.odds?`, odds ${money(odds)}${rate}`:""}`);
}
function resolveLoss(b,reason){
    b.delta  = -(b.flat + b.odds);
    b.result = "lose";
    log(`${reason}: ${b.type==="pass"?"PASS":"COME"+(b.point!==null?" on "+b.point:"")} loses ${money(b.flat+b.odds)}`);
}

/* ---------- Game finished counter ---------------------------------- */
function markGameComplete(){
    gamesCompleted++;
    log(`Game #${gamesCompleted} completed.`);
}

/* ---------- Dice roll ---------------------------------------------- */
function rollDice(){
    /* â€”â€” start of new roll: purge old coloured rows, refresh â€”â€”â€” */
    purgeResolved();
    updateUI(true);

    /* Pre-roll bet summary */
    const s=[]; if(passBet)s.push(`Pass-${passBet.point??"null"}:$${passBet.flat}${passBet.odds?`+${passBet.odds}`:""}`);
    for(const c of comeBets)s.push(`Come-${c.point??"?"}:$${c.flat}${c.odds?`+${c.odds}`:""}`);
    log(`Bets: ${s.join(" | ")||"none"}`);

    /* Roll dice */
    const d1=Math.floor(Math.random()*6)+1, d2=Math.floor(Math.random()*6)+1, sum=d1+d2;
    $("diceFace").textContent = dieCh[d1-1]+dieCh[d2-1];
    log(`Roll: ${d1}+${d2} = ${sum}`);

    const comingOut = (point===null);

    /* PASS line behaviour */
    if(comingOut){
        if([7,11].includes(sum)){ if(passBet) resolveWin(passBet,sum); }
        else if([2,3,12].includes(sum)){ if(passBet) resolveLoss(passBet,"Craps"); }
        else{ point = sum; if(passBet) passBet.point = point; log(`Point set to ${point}`); }
    }else{
        if(sum === point){
            if(passBet) resolveWin(passBet,sum);
            point = null;
            markGameComplete();
        }else if(sum === 7){
            if(passBet) resolveLoss(passBet,"Seven-out");
            for(const c of comeBets.filter(c=>c.point!==null)) resolveLoss(c,"Seven-out");
            markGameComplete();
        }
    }

    /* COME bet resolution */
    for(const c of comeBets){
        if(c.result) continue;
        if(c.point===null){
            if([7,11].includes(sum))      resolveWin(c,sum);
            else if([2,3,12].includes(sum)) resolveLoss(c,"COME craps");
            else{ c.point=sum; log(`COME travels to ${sum}`); }
        }else{
            if(sum === c.point) resolveWin(c,sum);
            else if(sum === 7)  resolveLoss(c,"Seven-out");
        }
    }

    /* Show coloured results, then drop them from arrays for accuracy */
    renderBetsList();    // show win / loss colours
    purgeResolved();     // now remove them internally
    stateLine();         // figures now correct
    updateUI(false);     // refresh numbers only
    comeWaiting = false;
}

/* ---------- Button wiring ------------------------------------------ */
$("btnPass").onclick = newPass;
$("btnCome").onclick = newCome;
$("btnOdds").onclick = takeOdds;
$("btnRoll").onclick = rollDice;

$("btnBankroll").onclick=()=>{
    const v=parseFloat(prompt("New bankroll:", bankroll));
    if(!isNaN(v)&&v>=0){ bankroll=v; log(`Bankroll set to ${money(v)}`); stateLine(); updateUI(); }
};
$("btnBetSize").onclick=()=>{
    const v=parseFloat(prompt("New base bet:", baseBet));
    if(!isNaN(v)&&v>0){ baseBet=v; log(`Base bet set to ${money(v)}`); stateLine(); updateUI(); }
};
$("btnOddsMax").onclick=()=>{
    const v=parseInt(prompt("Max odds multiple:", maxOdds),10);
    if(!isNaN(v)&&v>0){ maxOdds=v; log(`Max odds set to ${v}Ã—`); stateLine(); updateUI(); }
};

/* ---------- Init ---------------------------------------------------- */
log("Welcome! Bankroll $100. Base bet $1. Max odds 10Ã—.");
stateLine(); updateUI();
</script>
</body>
</html>
